(function(n){"use strict";function i(n){return typeof n=="function"}function r(n){return typeof n!="undefined"}function s(n){return typeof n=="string"}function y(n){var i=[],t;for(t in n)o.call(n,t)&&i.push(t);return i}function u(n,t){var r,i;if(n===t)return!0;if(typeof n!=typeof t)return!1;if(n==t)return!0;if(!n&&t||n&&!t||(i=h.call(n),h.call(t)!==i))return!1;if(i==="[object String]"||i==="[object Number]"||i==="[object Boolean]")return n==t;if(i==="[object Date]")return n.getTime()===t.getTime();if(y(n).length!==y(t).length)return!1;for(r in n)if(o.call(n,r)&&(!(r in t)||!u(n[r],t[r])))return!1;return!0}function g(n,t){return n>t?1:n<t?-1:0}function nt(n,t){return n.localeCompare(t)}function tt(n,t){var i,r=[],u;return n.split(",").forEach(function(n){i=n.trim().split(" "),r.push({field:i[0],direction:i[1]&&i[1].toLowerCase()==="desc"?-1:1,comparer:s(t[i[0]])?nt:g})}),u=r.length,function(n,t){for(var f=0,i,o,s,e;f<u;){if(i=r[f],o=n[i.field],s=t[i.field],e=i.comparer(o,s),e)return e*i.direction;f++}return 0}}function p(n,t,i,r,u){var f=[],e;return n.forEach(function(n){e=!1,t.forEach(function(t){i(n,t)&&(e=!0,f.push(r(n,t)))}),u&&!e&&f.push(r(n))}),f}function w(n,t,u,f){var o=[],e;return n.forEach(function(n,s){e=t(n,s),r(e)?i(e.forEach)?e.forEach(function(t){o.push(u(n,t))}):o.push(u(n,e)):f&&o.push(u(n))}),o}function b(n,t){var i;for(i in t)o.call(t,i)&&!r(n[i])&&(n[i]=t[i]);return n}function f(n,t){var i=b({},n);return r(t)&&b(i,t),i}function k(n){return function(t){return t[n]}}var t,c,l=Array.prototype,a=Object.prototype,e=l.slice,it=l.push,h=a.toString,o=a.hasOwnProperty,v=Math.min,d=Math.max;n.Query=t=function(n){return this.items=n&&e.call(n,0)||[],this},t.from=function(n){return new t(n)},t.Group=c=function(n,t){this.key=n,this.items=t||[]},t.prototype={avg:function(n){return this.sum(n)/this.items.length},count:function(n){return n?this.where(n).items.length:this.items.length},max:function(n){return d.apply(Math,i(n)?this.select(n).items:this.items)},min:function(n){return v.apply(Math,i(n)?this.select(n).items:this.items)},sum:function(n){var t=0,r=i(n);return this.forEach(function(i,u){t+=r?n(i,u):i}),t},where:function(n){if(n){var i=[];return this.forEach(function(t,r){n(t,r)&&i.push(t)}),new t(i)}return this.clone()},elementAt:function(n,t){return n>=this.items.length||n<0?t:this.items[n]},first:function(n,t){if(arguments.length!==1||i(n)||(t=n,n=null),t=r(t)?t:null,i(n)){for(var u=0,e=this.items.length,f;u<e;){if(f=this.items[u],n(f,u))return f;u++}return t}return this.items.length?this.items[0]:t},last:function(n,t){if(arguments.length!==1||i(n)||(t=n,n=null),t=r(t)?t:null,i(n)){for(var u=this.items.length,f;u--;)if(f=this.items[u],n(f,u))return f;return t}return this.items.length?this.items[this.items.length-1]:t},single:function(n,t){var f=this.items.length,u=[],e;if(arguments.length!==1||i(n)||(t=n,n=null),n){while(f--)if(e=this.items[f],n(e,f)&&u.push(e),u.length===2)break}else u=this.items;if(!u.length&&r(t))return t;if(u.length!==1)throw new Error("Only one result should be found when calling 'single'.");return u[0]},all:function(n){for(var t=this.items.length;t--;)if(!n(this.items[t],t))return!1;return!0},any:function(n){return this.last(n)!==null},contains:function(n,t){for(var i=this.items.length,r=t||u;i--;)if(r(this.items[i],n))return!0;return!1},select:function(n){return new t(this.items.map(n))},concat:function(n){return new t(this.toArray().concat(n.items||n))},distinct:function(n){var i,r=this,e=r.items.length,f=[],o=n||u;return r.forEach(function(n,t){for(i=e;--i>t&&!o(n,r.items[i]););t===i&&f.push(n)}),new t(f)},except:function(n,i){var r=[],f=i||u;return n=n instanceof Query?n:new t(n),this.forEach(function(t){n.contains(t,f)||r.push(t)}),new t(r).distinct(f)},intersect:function(n,i){var r=[],f=i||u;return n=n instanceof Query?n:new t(n),this.forEach(function(t){n.contains(t,f)&&r.push(t)}),new t(r).distinct(f)},union:function(n,i){return new t(this.items.concat(n.items||n)).distinct(i)},zip:function(n,i){var r=0,e=v.call(null,this.items.length,(n.items||n).length),i=i||f,u=[];for(n=n.items||n;r<e;)u.push(i(this.items[r],n[r])),r++;return new t(u)},crossApply:function(n,i){return new t(w(this.items,n,i||f,!1))},crossJoin:function(n,i){var r=[],u=i||f;return this.forEach(function(t){n.forEach(function(n){r.push(u(t,n))})}),new t(r)},join:function(n,i,r){return new t(p(this.items,n.items||n,i,r||f,!1))},outerApply:function(n,i){return new t(w(this.items,n,i||f,!0))},outerJoin:function(n,i,r){return new t(p(this.items,n.items||n,i,r||f,!0))},skip:function(n){return new t(e.call(this.items,n))},skipWhile:function(n){for(var t=0,i=this.items.length;t<i&&n(this.items[t],t);)t++;return this.skip(t)},take:function(n){return new t(e.call(this.items,0,n))},takeWhile:function(n){for(var t=0,i=this.items.length;t<i&&n(this.items[t],t);)t++;return this.take(t)},groupBy:function(n,i){var r,u,f=[];u=this.toLookup(n,i);for(r in u)o.call(u,r)&&f.push(new c(r,u[r]));return new t(f)},orderBy:function(n){if(this.items.length<2)return this.clone();var i;return i=s(n)?tt(n,this.items[0]):n,new t(this.items.sort(i))},reverse:function(){return new t(this.toArray().reverse())},clone:function(){return new t(this.toArray())},defaultIfEmpty:function(n){return this.items.length?this:new t([n])},forEach:function(n,t){return this.items.forEach(n,t),this},sequenceEquals:function(n,t){var i=this.items.length,n=n.items||n,r=t||u;if(n.length!==this.items.length)return!1;while(i--)if(!r(this.items[i],n[i]))return!1;return!0},toArray:function(){return e.call(this.items,0)},toDictionary:function(n,t){var r,u={},f=i(t);return n=s(n)?k(n):n,this.forEach(function(i,e){if(r=n(i,e),r in u)throw error("Duplicate keys were attempted to be inserted.");u[r]=f?t(i,e):i}),u},toLookup:function(n,t){var r,u={},f=i(t);return n=s(n)?k(n):n,this.forEach(function(i,e){r=n(i,e),u[r]=u[r]||[],u[r].push(f?t(i,e):i)}),u}}})(window||global)